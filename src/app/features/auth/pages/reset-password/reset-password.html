<app-auth-layout>
  <mat-card class="reset-password-card">
      <mat-card-header>
        <mat-card-title>{{ languageService.t('resetPassword.title') }}</mat-card-title>
        <mat-card-subtitle>{{ languageService.t('resetPassword.subtitle') }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Error Alert -->
        @if (error) {
          <div class="error-alert">
            <mat-icon>error</mat-icon>
            <p>{{ error }}</p>
          </div>
        }

        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
          <!-- New Password Field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ languageService.t('resetPassword.newPassword') }}</mat-label>
            <input
              matInput
              [type]="showNewPassword ? 'text' : 'password'"
              formControlName="newPassword"
              [placeholder]="languageService.t('resetPassword.newPasswordPlaceholder')"
              required
              [disabled]="!token || isLoading">
            <mat-icon matPrefix>lock</mat-icon>
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="toggleNewPasswordVisibility()"
              [disabled]="!token || isLoading"
              [attr.aria-label]="'Toggle password visibility'">
              <mat-icon>{{showNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            @if (resetPasswordForm.get('newPassword')?.hasError('required') && resetPasswordForm.get('newPassword')?.touched) {
              <mat-error>Password is required</mat-error>
            }
            @if (resetPasswordForm.get('newPassword')?.hasError('minlength') && resetPasswordForm.get('newPassword')?.touched) {
              <mat-error>Password must be at least 6 characters</mat-error>
            }
          </mat-form-field>

          <!-- Confirm Password Field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ languageService.t('resetPassword.confirmPassword') }}</mat-label>
            <input
              matInput
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword"
              [placeholder]="languageService.t('resetPassword.confirmPasswordPlaceholder')"
              required
              [disabled]="!token || isLoading">
            <mat-icon matPrefix>lock</mat-icon>
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="toggleConfirmPasswordVisibility()"
              [disabled]="!token || isLoading"
              [attr.aria-label]="'Toggle password visibility'">
              <mat-icon>{{showConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            @if (resetPasswordForm.get('confirmPassword')?.hasError('required') && resetPasswordForm.get('confirmPassword')?.touched) {
              <mat-error>Please confirm your password</mat-error>
            }
            @if (resetPasswordForm.hasError('passwordMismatch') && resetPasswordForm.get('confirmPassword')?.touched) {
              <mat-error>{{ languageService.t('resetPassword.passwordsDoNotMatch') }}</mat-error>
            }
          </mat-form-field>

          <!-- Action Buttons -->
          <div class="button-group">
            <button
              mat-raised-button
              type="submit"
              class="submit-button amazon-button"
              [disabled]="!token || isLoading || resetPasswordForm.invalid">
              @if (isLoading) {
                <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
                <span>{{ languageService.t('resetPassword.confirming') }}</span>
              } @else {
                <span>{{ languageService.t('resetPassword.confirmButton') }}</span>
              }
            </button>

            <button
              mat-stroked-button
              type="button"
              class="cancel-button"
              (click)="onCancel()"
              [disabled]="isLoading">
              {{ languageService.t('resetPassword.cancelButton') }}
            </button>
          </div>

          <!-- Back to Login Link -->
          <div class="back-to-login">
            <a routerLink="/auth/login" class="back-link">
              {{ languageService.t('forgotPassword.backToLogin') }}
            </a>
          </div>
        </form>
      </mat-card-content>
  </mat-card>
</app-auth-layout>
