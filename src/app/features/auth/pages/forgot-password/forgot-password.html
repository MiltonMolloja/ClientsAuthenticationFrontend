<app-auth-layout>
  <!-- Success State - Email Sent -->
  @if (emailSent) {
    <mat-card class="forgot-password-card">
      <mat-card-header class="text-center">
        <div class="icon-wrapper">
          <div class="icon-container success">
            <mat-icon class="success-icon">check_circle</mat-icon>
          </div>
        </div>
        <mat-card-title class="card-title">{{ languageService.t('forgotPasswordPage.checkEmailTitle') }}</mat-card-title>
        <mat-card-subtitle class="card-description">
          {{ languageService.t('forgotPasswordPage.checkEmailSubtitle') }} {{ submittedEmail }}, {{ languageService.t('forgotPasswordPage.checkEmailMessage') }}
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="card-content">
        <div class="info-box">
          <mat-icon class="info-icon">mail</mat-icon>
          <p class="info-text">
            {{ languageService.t('forgotPasswordPage.emailNote') }}
          </p>
        </div>
      </mat-card-content>

      <mat-card-footer class="card-footer">
        <a routerLink="/auth/login" class="back-link">
          {{ languageService.t('forgotPasswordPage.backToSignIn') }}
        </a>
      </mat-card-footer>
    </mat-card>
  }

  <!-- Form State - Enter Email -->
  @else {
    <mat-card class="forgot-password-card">
      <mat-card-header>
        <mat-card-title class="card-title">{{ languageService.t('forgotPasswordPage.title') }}</mat-card-title>
        <mat-card-subtitle class="card-description">
          {{ languageService.t('forgotPasswordPage.subtitle') }}
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="card-content">
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ languageService.t('forgotPasswordPage.emailLabel') }}</mat-label>
            <input
              matInput
              type="email"
              formControlName="email"
              [placeholder]="languageService.t('forgotPasswordPage.emailPlaceholder')"
              required>
            <mat-icon matPrefix>email</mat-icon>
            @if (forgotPasswordForm.get('email')?.hasError('required') && forgotPasswordForm.get('email')?.touched) {
              <mat-error>{{ languageService.t('forgotPasswordPage.emailRequired') }}</mat-error>
            }
            @if (forgotPasswordForm.get('email')?.hasError('email') && forgotPasswordForm.get('email')?.touched) {
              <mat-error>{{ languageService.t('forgotPasswordPage.emailInvalid') }}</mat-error>
            }
          </mat-form-field>

          <button
            mat-raised-button
            type="submit"
            class="submit-button"
            [disabled]="forgotPasswordForm.invalid || isLoading">
            @if (isLoading) {
              <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
              <span>{{ languageService.t('forgotPasswordPage.sending') }}</span>
            } @else {
              <span>{{ languageService.t('forgotPasswordPage.sendResetLink') }}</span>
            }
          </button>
        </form>
      </mat-card-content>

      <mat-card-footer class="card-footer">
        <a routerLink="/auth/login" class="back-link">
          {{ languageService.t('forgotPasswordPage.backToSignIn') }}
        </a>
      </mat-card-footer>
    </mat-card>
  }
</app-auth-layout>
