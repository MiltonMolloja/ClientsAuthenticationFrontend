<app-auth-layout>
  <!-- Success State - Email Sent -->
  @if (emailSent) {
    <mat-card class="forgot-password-card">
      <mat-card-header class="text-center">
        <div class="icon-wrapper">
          <div class="icon-container success">
            <mat-icon class="success-icon">check_circle</mat-icon>
          </div>
        </div>
        <mat-card-title class="card-title">Check Your Email</mat-card-title>
        <mat-card-subtitle class="card-description">
          If an account exists for {{ submittedEmail }}, you will receive a password reset link shortly.
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="card-content">
        <div class="info-box">
          <mat-icon class="info-icon">mail</mat-icon>
          <p class="info-text">
            The email may take a few minutes to arrive. Please check your spam folder if you don't see it.
          </p>
        </div>
      </mat-card-content>

      <mat-card-footer class="card-footer">
        <a routerLink="/auth/login" class="back-link">
          Back to Sign In
        </a>
      </mat-card-footer>
    </mat-card>
  }

  <!-- Form State - Enter Email -->
  @else {
    <mat-card class="forgot-password-card">
      <mat-card-header>
        <mat-card-title class="card-title">Forgot Password?</mat-card-title>
        <mat-card-subtitle class="card-description">
          Enter your email address and we'll send you a link to reset your password
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="card-content">
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input
              matInput
              type="email"
              formControlName="email"
              placeholder="john.doe@example.com"
              required>
            <mat-icon matPrefix>email</mat-icon>
            @if (forgotPasswordForm.get('email')?.hasError('required') && forgotPasswordForm.get('email')?.touched) {
              <mat-error>Email is required</mat-error>
            }
            @if (forgotPasswordForm.get('email')?.hasError('email') && forgotPasswordForm.get('email')?.touched) {
              <mat-error>Please enter a valid email</mat-error>
            }
          </mat-form-field>

          <button
            mat-raised-button
            type="submit"
            class="submit-button"
            [disabled]="forgotPasswordForm.invalid || isLoading">
            @if (isLoading) {
              <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
              <span>Sending...</span>
            } @else {
              <span>Send Reset Link</span>
            }
          </button>
        </form>
      </mat-card-content>

      <mat-card-footer class="card-footer">
        <a routerLink="/auth/login" class="back-link">
          Back to Sign In
        </a>
      </mat-card-footer>
    </mat-card>
  }
</app-auth-layout>
